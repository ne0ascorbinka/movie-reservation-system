{% load tz %}
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ù–∞–π–±–ª–∏–∂—á—ñ —Å–µ–∞–Ω—Å–∏ ‚Äî –ö—ñ–Ω–æ—Ç–µ–∞—Ç—Ä</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .poster { width: 90px; border-radius: 8px; }
    .movie-card { margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .time-pill {
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 4px 10px;
        margin-right: 5px;
        font-weight: 600;
        text-decoration: none;
        color: #0d6efd;
    }
    .time-pill:hover { background: #0d6efd; color: white; }
  </style>
</head>
<body>
<div class="container py-4">
  <h2 class="mb-4 text-center">üé¨ –ù–∞–π–±–ª–∏–∂—á—ñ —Å–µ–∞–Ω—Å–∏</h2>

  <!-- –í–∫–ª–∞–¥–∫–∏ –¥–Ω—ñ–≤ -->
  <div class="d-flex flex-wrap gap-2 justify-content-center mb-4">
    {% for d in days %}
      {% if d == selected_date %}
        <a href="{% url 'movies:showtimes_by_date' d|date:'Y-m-d' %}" class="btn btn-primary btn-sm">
          {{ d|date:"D, j M" }}{% if d == now.date %} (–°—å–æ–≥–æ–¥–Ω—ñ){% endif %}
        </a>
      {% else %}
        <a href="{% url 'movies:showtimes_by_date' d|date:'Y-m-d' %}" class="btn btn-outline-secondary btn-sm">
          {{ d|date:"D, j M" }}
        </a>
      {% endif %}
    {% endfor %}
  </div>

  {% if not showtimes.exists %}
    <div class="alert alert-info text-center">–ù–∞ –æ–±—Ä–∞–Ω—É –¥–∞—Ç—É —Å–µ–∞–Ω—Å—ñ–≤ –Ω–µ–º–∞—î.</div>
  {% else %}
    {% regroup showtimes by movie as grouped_showtimes %}
    {% for group in grouped_showtimes %}
      {% with movie=group.grouper %}
      <div class="card movie-card">
        <div class="card-body d-flex">
          {% if movie.poster_url %}
            <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="poster me-3">
          {% endif %}
          <div>
            <h5>{{ movie.title }}</h5>
            <p class="text-muted small">{{ movie.duration_minutes }} —Ö–≤ ‚Ä¢ 
              {% for g in movie.genres.all %}
                {{ g.name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </p>
            {% for s in group.list %}
              <a href="#" class="time-pill">
                {{ s.start_time|localtime|date:"H:i" }} ‚Äî {{ s.hall.name }} ‚Ä¢ ‚Ç¥{{ s.price }}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endwith %}
    {% endfor %}
  {% endif %}
</div>
</body>
</html>
